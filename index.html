<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catatan Pembelian</title>

<!-- jsPDF & autotable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<style>
*{box-sizing:border-box;}
body {
  font-family: 'Segoe UI', sans-serif;
  margin: 0; padding: 20px;
  background: #f2f7ff;
}
.container {
  max-width: 480px; margin: auto; background: #fff; padding: 20px;
  border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}
h2 { text-align:center; margin-top:0; }

.form-group { margin-bottom:12px; }
label { font-size:14px; font-weight:600; display:block; margin-bottom:5px; }
input, select {
  width:100%; padding:10px; border:1px solid #ccc;
  border-radius:6px; font-size:15px;
}
button {
  width:100%; padding:12px; font-size:16px;
  background:#007bff; border:none; border-radius:8px; color:#fff;
  cursor:pointer; font-weight:600; margin-top:8px;
}
button:hover { background:#0069d9; }

.list { margin-top:20px; }
.item {
  background:#fff; padding:12px; margin-bottom:10px;
  border-radius:8px; border-left:5px solid #007bff;
}
.item-title { font-weight:700; font-size:16px; }
.item-sub { font-size:14px; color:#555; margin-top:3px; }
.item-amt { font-size:16px; font-weight:600; margin-top:3px; }
</style>
</head>
<body>

<div class="container">
  <h2>Catatan Pembelian</h2>

  <div class="form-group">
    <label>Pembelian</label>
    <input type="text" id="description" placeholder="Contoh: Beras">
  </div>

  <div style="display:flex; gap:10px;">
    <div class="form-group" style="flex:1;">
      <label>Jumlah</label>
      <input type="number" id="quantity" placeholder="0" min="1" value="1">
    </div>

    <div class="form-group" style="flex:1;">
      <label>Satuan</label>
      <select id="unit">
        <option value="pcs">pcs</option>
        <option value="kg">kg</option>
        <option value="liter">liter</option>
        <option value="pack">pack</option>
        <option value="box">box</option>
        <option value="unit">unit</option>
      </select>
    </div>
  </div>

  <div class="form-group">
    <label>Harga per Unit (Rp)</label>
    <input type="number" id="pricePerUnit" placeholder="Contoh: 5000" min="0">
  </div>

  <div class="form-group">
    <label>Nominal Total (Rp)</label>
    <input type="number" id="amount" placeholder="0" min="0">
  </div>

  <div class="form-group">
    <label>Tanggal</label>
    <input type="date" id="date">
  </div>

  <button id="saveBtn">Simpan</button>
  <button id="exportPDF" style="background:#28a745;">Export PDF</button>

  <div class="list" id="list"></div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("pembelian") || "[]");
render();

// Auto hitung
document.getElementById("pricePerUnit").addEventListener("input", auto)
document.getElementById("quantity").addEventListener("input", auto)
function auto(){
  amount.value = (parseFloat(quantity.value||0) * parseFloat(pricePerUnit.value||0)) || "";
}

document.getElementById("saveBtn").onclick = () => {
  const description = descriptionField.value.trim();
  const qty = parseFloat(quantity.value);
  const unit = unitField.value;
  const price = parseFloat(pricePerUnit.value);
  const amt = parseFloat(amount.value);
  const dateVal = date.value || new Date().toISOString().split("T")[0];

  if (!description || !qty || !amt){
    alert("Silakan isi semua data");
    return;
  }

  data.push({id:Date.now(), description, qty, unit, price, amt, date:dateVal});
  localStorage.setItem("pembelian", JSON.stringify(data));
  render(); reset();
};

// PDF EXPORT
document.getElementById("exportPDF").onclick = () => {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.text("Laporan Pembelian", 14, 10);

  const rows = data.map(i => [
    i.description,
    `${i.qty} ${i.unit}`,
    `Rp ${i.price.toLocaleString()}`,
    `Rp ${i.amt.toLocaleString()}`,
    i.date
  ]);

  doc.autoTable({
    startY: 15,
    head: [["Pembelian", "Jumlah", "Harga/Unit", "Nominal", "Tanggal"]],
    body: rows
  });

  doc.save("laporan_pembelian.pdf");
};

// Render list
function render(){
  list.innerHTML = "";
  data.forEach(i=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML=`
      <div class="item-title">${i.description}</div>
      <div class="item-sub">${i.qty} ${i.unit} â€¢ ${i.date}</div>
      <div class="item-amt">Rp ${i.amt.toLocaleString()}</div>
    `;
    list.appendChild(d);
  });
}

// Reset
const descriptionField=document.getElementById("description"),
      quantityField=document.getElementById("quantity"),
      unitField=document.getElementById("unit"),
      pricePerUnitField=document.getElementById("pricePerUnit"),
      amountField=document.getElementById("amount"),
      dateField=document.getElementById("date");

function reset(){
  descriptionField.value="";
  quantityField.value=1;
  unitField.value="pcs";
  pricePerUnitField.value="";
  amountField.value="";
  dateField.value="";
}
</script>
</body>
</html>
