<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catatan Pembelian</title>

<style>
*{box-sizing:border-box;}
body {
  font-family: 'Segoe UI', sans-serif;
  margin: 0; padding: 20px; background: #f2f7ff;
}
.container {
  max-width: 480px; margin: auto; background: #fff; padding: 20px;
  border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}
/* SLIDER */
.slider-wrapper {
  max-width: 480px;
  margin: auto;
  overflow: hidden;
  position: relative;
}

.slider {
  display: flex;
  transition: transform 0.4s ease;
}

.slide {
  min-width: 100%;
}
.slider-wrapper {
  touch-action: pan-y;
}

/* NAV BUTTON */
.nav-btn {
  position:absolute;
  bottom: 5px;
  transform:none;
}
.nav-btn.left { left: 10px; }
.nav-btn.right { right: 10px; }


h2 { text-align:center; margin-top:0; }
.form-group { margin-bottom:12px; }
label { font-size:14px; font-weight:600; display:block; margin-bottom:5px; }
input, select {
  width:100%; padding:10px; border:1px solid #ccc;
  border-radius:6px; font-size:15px;
}
button {
  width:100%; padding:12px; font-size:16px;
  background:#007bff; border:none; border-radius:8px; color:#fff;
  cursor:pointer; font-weight:600; margin-bottom:8px;
}
button:hover { background:#0069d9; }
#toggleBtn { background:#28a745; }
#toggleBtn:hover { background:#218838; }

.logout-btn {
  background:#ff4d4d;
  border:none;
  padding:8px 14px;
  font-size:14px;
  color:white;
  border-radius:6px;
  cursor:pointer;
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 9999;
  display:inline-block;
  width:auto;
  height:auto;
  white-space:nowrap;
}
.logout-btn:hover {
  background:#d63c3c;
}

/* POPUP */
.modal {
  display:none; position:fixed; top:0; left:0;
  width:100%; height:100%; background:rgba(0,0,0,0.5);
  justify-content:center; align-items:center;
}
.modal-content {
  background:#fff; padding:20px; width:90%; max-width:650px;
  border-radius:10px; position:relative;
  max-height:85vh; overflow-y:auto;
}
.close {
  position:absolute; right:12px; top:8px;
  font-size:22px; font-weight:bold; cursor:pointer;
}
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td {
  border:1px solid #ddd; padding:10px; text-align:center;
  font-size:14px;
}
th { background:#007bff; color:white; }

.delete-btn {
  background:#dc3545; border:none; color:white; padding:6px 10px;
  border-radius:5px; cursor:pointer;
}
.delete-btn:hover { background:#b02a37; }

.total-box {
  margin-top:10px; font-size:16px; font-weight:bold; text-align:right;
}
.filter-input {
  width:100%; font-size:12px; padding:3px; margin-top:3px;
}
  /* DOT SLIDER */
.dots {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-top: 12px;
}

.dot {
  width: 10px;
  height: 10px;
  background: #ccc;
  border-radius: 50%;
  cursor: pointer;
  transition: 0.3s;
}

.dot.active {
  background: #007bff;
  transform: scale(1.4);
}

</style>
</head>

<body>
<button class="logout-btn" onclick="logout()">Logout</button>
<div class="slider-wrapper">

  <div class="slider" id="slider">

    <!-- SLIDE 1 -->
    <div class="slide">
      <div class="container">
  <h2>Catatan Pembelian Harian</h2>

  <div class="form-group">
    <label>Pembelian</label>
    <input type="text" id="description" placeholder="Contoh: Beras">
  </div>

  <div style="display:flex; gap:10px;">
    <div class="form-group" style="flex:1;">
      <label>Jumlah</label>
      <input type="number" id="quantity" placeholder="0" min="1" value="1">
    </div>

    <div class="form-group" style="flex:1;">
      <label>Satuan</label>
      <select id="unit">
        <option value="pcs">pcs</option>
        <option value="kg">kg</option>
        <option value="liter">liter</option>
        <option value="pack">pack</option>
        <option value="box">box</option>
        <option value="unit">botol</option>
      </select>
    </div>
  </div>

  <div class="form-group">
    <label>Harga per Unit (Rp)</label>
    <input type="number" id="pricePerUnit" placeholder="Contoh: 5000">
  </div>

  <div class="form-group">
    <label>Nominal Total (Rp)</label>
    <input type="number" id="amount" placeholder="0">
  </div>

  <div class="form-group">
    <label>Tanggal</label>
    <input type="date" id="date">
  </div>

  <button id="saveBtn">Simpan</button>
  <button id="toggleBtn">Tampilkan Data</button>
</div>
</div>
 <div class="slide">

<div class="container">
  <h2>Catatan Pembelian Bulanan</h2>

  <div class="form-group">
    <label>Pembelian</label>
    <input type="text" id="description2" placeholder="Contoh: Gula">
  </div>

  <div style="display:flex; gap:10px;">
    <div class="form-group" style="flex:1;">
      <label>Jumlah</label>
      <input type="number" id="quantity2" placeholder="0" min="1" value="1">
    </div>

    <div class="form-group" style="flex:1;">
      <label>Satuan</label>
      <select id="unit2">
        <option value="pcs">pcs</option>
        <option value="kg">kg</option>
        <option value="liter">liter</option>
        <option value="pack">pack</option>
        <option value="box">box</option>
        <option value="unit">botol</option>
      </select>
    </div>
  </div>

  <div class="form-group">
    <label>Harga per Unit (Rp)</label>
    <input type="number" id="pricePerUnit2" placeholder="Contoh: 5000">
  </div>

  <div class="form-group">
    <label>Nominal Total (Rp)</label>
    <input type="number" id="amount2" placeholder="0">
  </div>

  <div class="form-group">
    <label>Tanggal</label>
    <input type="date" id="date2">
  </div>

  <button id="saveBtn2">Simpan</button>
  <button id="toggleBtn2" style="background:#6f42c1;">Tampilkan Data</button>
</div>
 </div>

  <div class="dots" id="dots"></div>

</div>

<!-- POPUP -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3 style="text-align:center;margin:0;">Data Pembelian Harian</h3>
    <div style="text-align:right; margin-top:10px;">
  <button onclick="exportPDF()" style="
    background:#dc3545; 
    color:#fff; 
    padding:8px 12px; 
    border:none; 
    border-radius:6px; 
    cursor:pointer;
    font-size:14px;
  ">Export PDF</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Pembelian</th>
          <th>Jumlah</th>
          <th>Satuan</th>
          <th>Harga/Unit (Rp)</th>
          <th>Nominal Total (Rp)</th>
          <th>
            Tanggal
            <input type="date" id="filterStart" class="filter-input">
            <input type="date" id="filterEnd" class="filter-input">
          </th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

    <div class="total-box">
      Total: Rp <span id="totalBelanja">0</span>
    </div>
  </div>
</div>
<!-- POPUP KE-2 -->
<div id="modal2" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal2()">&times;</span>
    <h3 style="text-align:center;margin:0;">Data Pembelian Bulanan</h3>
    <div style="text-align:right; margin-top:10px;">
  <button onclick="exportPDF2()" style="
    background:#dc3545;
    color:#fff;
    padding:8px 12px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-size:14px;
  ">Export PDF</button>
</div>

    <table>
      <thead>
        <tr>
          <th>Pembelian</th>
          <th>Jumlah</th>
          <th>Satuan</th>
          <th>Harga/Unit</th>
          <th>Nominal</th>
          <th>
  Tanggal
  <input type="date" id="filterStart2" class="filter-input">
  <input type="date" id="filterEnd2" class="filter-input">
</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="tableBody2"></tbody>
    </table>

    <div class="total-box">
      Total: Rp <span id="totalBelanja2">0</span>
    </div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBMh_kw-d_YPteiDEMoKhb9WNZHqVljgRs",
  authDomain: "counting-8ba9d.firebaseapp.com",
  projectId: "counting-8ba9d",
  storageBucket: "counting-8ba9d.firebasestorage.app",
  messagingSenderId: "1023489535017",
  appId: "1:1023489535017:web:6083691f9e7cd367a50038"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>
  <script>
firebase.auth().onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "login.html";
  }
});
  </script>

<script>
let data = [];
const modal = document.getElementById("modal");
const saveBtn = document.getElementById("saveBtn");
const toggleBtn = document.getElementById("toggleBtn");
const description = document.getElementById("description");
const quantity = document.getElementById("quantity");
const unit = document.getElementById("unit");
const pricePerUnit = document.getElementById("pricePerUnit");
const amount = document.getElementById("amount");
const date = document.getElementById("date");
const tableBody = document.getElementById("tableBody");
const filterStart = document.getElementById("filterStart");
const filterEnd = document.getElementById("filterEnd");
const totalBelanja = document.getElementById("totalBelanja");
  
// Auto hitung total
pricePerUnit.addEventListener("input", autoHitung)
quantity.addEventListener("input", autoHitung)
function autoHitung(){
  amount.value = (parseFloat(quantity.value)||0) * (parseFloat(pricePerUnit.value)||0);
}

// ✅ Simpan + auto tampil popup
saveBtn.onclick = async ()=>{
  const item = {
    description: description.value.trim(),
    quantity: parseFloat(quantity.value),
    unit: unit.value,
    pricePerUnit: parseFloat(pricePerUnit.value),
    amount: parseFloat(amount.value),
    date: date.value || new Date().toISOString().split("T")[0],
    time: Date.now()
  };

  if(!item.description || !item.amount){
    alert("Isi data!");
    return;
  }

  await db.collection("pembelian").add(item);
  resetForm();

  await loadData();
  modal.style.display = "flex"; // ✅ auto buka popup
};

// tombol tampilkan data manual
toggleBtn.onclick = ()=>{ loadData(); modal.style.display="flex"; };

// ambil data dari Firebase
async function loadData(){
  const snapshot = await db.collection("pembelian").orderBy("time","desc").get();
  data = snapshot.docs.map(d=>({ id:d.id, ...d.data() }));
  renderTable();
}

function renderTable(){
  const tbody = tableBody;
  tbody.innerHTML = "";
  let total = 0;

  const start = filterStart.value;
  const end = filterEnd.value;

  const filtered = data.filter(x=>{
    return (!start || x.date>=start) && (!end || x.date<=end);
  });

  filtered.forEach(item=>{
    total += item.amount;
    tbody.innerHTML += `
  <tr>
    <td>${item.description}</td>
    <td>${item.quantity}</td>
    <td>${item.unit}</td>
    <td>Rp ${item.pricePerUnit.toLocaleString()}</td>
    <td>Rp ${item.amount.toLocaleString()}</td>
    <td>${item.date}</td>
    <td><button class="delete-btn" onclick="hapus('${item.id}')">Hapus</button></td>
  </tr>`;
    
  });

  totalBelanja.textContent = total.toLocaleString();
}

filterStart.onchange = renderTable;
filterEnd.onchange = renderTable;

async function hapus(id){
  if(confirm("Hapus data?")){
    await db.collection("pembelian").doc(id).delete();
    loadData();
  }
}

function closeModal(){ modal.style.display="none"; }

function resetForm(){
  description.value="";
  quantity.value=1;
  pricePerUnit.value="";
  amount.value="";
  date.value="";
  unit.value="pcs";
}
  async function exportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const rows = [];
  const tbody = document.querySelectorAll("#tableBody tr");

  tbody.forEach(tr => {
    const cols = [...tr.children].map(td => td.innerText);
    cols.pop(); // hapus kolom "Aksi"
    rows.push(cols);
  });

  doc.text("Laporan Pembelian", 14, 10);

  // Tanggal filter di header PDF
  const start = filterStart.value || "-";
  const end = filterEnd.value || "-";
  doc.text(`Periode: ${start} s/d ${end}`, 14, 18);

  doc.autoTable({
    head: [["Pembelian", "Qty", "Satuan", "Harga/Unit", "Nominal", "Tanggal"]],
    body: rows,
    startY: 26
  });

  const total = document.getElementById("totalBelanja").innerText;
  doc.text(`Total Belanja: Rp ${total}`, 14, doc.lastAutoTable.finalY + 10);

  doc.save(`laporan-pembelian-${Date.now()}.pdf`);
  }
  function logout() {
  firebase.auth().signOut().then(() => {
    window.location.href = "login.html"; // arahkan ke halaman login
  });
  }
   // ---------------------------
// FORM 2 (SAMA PERSIS VERSI 1)
// ---------------------------
let data2 = [];

const modal2 = document.getElementById("modal2");
const saveBtn2 = document.getElementById("saveBtn2");
const toggleBtn2 = document.getElementById("toggleBtn2");

const description2 = document.getElementById("description2");
const quantity2 = document.getElementById("quantity2");
const unit2 = document.getElementById("unit2");
const pricePerUnit2 = document.getElementById("pricePerUnit2");
const amount2 = document.getElementById("amount2");
const date2 = document.getElementById("date2");
const tableBody2 = document.getElementById("tableBody2");
const totalBelanja2 = document.getElementById("totalBelanja2");
const filterStart2 = document.getElementById("filterStart2");
const filterEnd2 = document.getElementById("filterEnd2");


// AUTO HITUNG
pricePerUnit2.addEventListener("input", autoHitung2);
quantity2.addEventListener("input", autoHitung2);

function autoHitung2(){
  amount2.value = (parseFloat(quantity2.value)||0) * (parseFloat(pricePerUnit2.value)||0);
}

// SIMPAN DATA
saveBtn2.onclick = async ()=>{
  const item = {
    description: description2.value.trim(),
    quantity: parseFloat(quantity2.value),
    unit: unit2.value,
    pricePerUnit: parseFloat(pricePerUnit2.value),
    amount: parseFloat(amount2.value),
    date: date2.value || new Date().toISOString().split("T")[0],
    time: Date.now()
  };

  if(!item.description || !item.amount){
    alert("Isi data!");
    return;
  }

  await db.collection("pembelian2").add(item);
  resetForm2();

  await loadData2();
  modal2.style.display = "flex";
};

// TAMPILKAN DATA 2
toggleBtn2.onclick = ()=>{
  loadData2();
  modal2.style.display = "flex";
};

// LOAD DATA 2
async function loadData2(){
  const snapshot = await db.collection("pembelian2").orderBy("time","desc").get();
  data2 = snapshot.docs.map(d=>({ id:d.id, ...d.data() }));
  renderTable2();
}

function renderTable2(){
  tableBody2.innerHTML="";
  let total = 0;

  const start = filterStart2.value;
  const end = filterEnd2.value;

  const filtered = data2.filter(item=>{
    return (!start || item.date >= start) &&
           (!end || item.date <= end);
  });

  filtered.forEach(item=>{
    total += item.amount;

    tableBody2.innerHTML += `
      <tr>
        <td>${item.description}</td>
        <td>${item.quantity}</td>
        <td>${item.unit}</td>
        <td>Rp ${item.pricePerUnit.toLocaleString()}</td>
        <td>Rp ${item.amount.toLocaleString()}</td>
        <td>${item.date}</td>
        <td><button class="delete-btn" onclick="hapus2('${item.id}')">Hapus</button></td>
      </tr>
    `;
  });

  totalBelanja2.textContent = total.toLocaleString();
}
filterStart2.onchange = renderTable2;
filterEnd2.onchange = renderTable2;


async function hapus2(id){
  if(confirm("Hapus data?")){
    await db.collection("pembelian2").doc(id).delete();
    loadData2();
  }
}

function closeModal2(){ modal2.style.display="none"; }

function resetForm2(){
  description2.value="";
  quantity2.value=1;
  pricePerUnit2.value="";
  amount2.value="";
  date2.value="";
  unit2.value="pcs";
}  

  async function exportPDF2() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const rows = [];
  const tbody = document.querySelectorAll("#tableBody2 tr");

  tbody.forEach(tr => {
    const cols = [...tr.children].map(td => td.innerText);
    cols.pop(); // hapus kolom aksi
    rows.push(cols);
  });

  doc.text("Laporan Pembelian 2", 14, 10);

  const start = filterStart2.value || "-";
  const end = filterEnd2.value || "-";
  doc.text(`Periode: ${start} s/d ${end}`, 14, 18);

  doc.autoTable({
    head: [["Pembelian","Qty","Satuan","Harga/Unit","Nominal","Tanggal"]],
    body: rows,
    startY: 26
  });

  const total = document.getElementById("totalBelanja2").innerText;
  doc.text(`Total Belanja: Rp ${total}`, 14, doc.lastAutoTable.finalY + 10);

  doc.save(`laporan-pembelian2-${Date.now()}.pdf`);
}
</script>
  <script>
let currentSlide = 0;

const slider = document.getElementById("slider");
const sliderWrapper = document.querySelector(".slider-wrapper");
const slides = document.querySelectorAll(".slide");
const dotsContainer = document.getElementById("dots");
const totalSlide = slides.length;

// === BUAT DOT OTOMATIS ===
function createDots(){
  dotsContainer.innerHTML = "";
  slides.forEach((_, i) => {
    const dot = document.createElement("div");
    dot.className = "dot" + (i === 0 ? " active" : "");
    dot.onclick = () => goToSlide(i);
    dotsContainer.appendChild(dot);
  });
}

function updateDots(){
  document.querySelectorAll(".dot").forEach((dot, i) => {
    dot.classList.toggle("active", i === currentSlide);
  });
}

function goToSlide(index){
  currentSlide = index;
  updateSlide();
}

function updateSlide(){
  slider.style.transform = `translateX(-${currentSlide * 100}%)`;
  updateDots();
}

// === SWIPE ===
let startX = 0;
let startY = 0;

sliderWrapper.addEventListener("touchstart", e => {
  startX = e.touches[0].clientX;
  startY = e.touches[0].clientY;
}, { passive: true });

sliderWrapper.addEventListener("touchend", e => {
  const endX = e.changedTouches[0].clientX;
  const endY = e.changedTouches[0].clientY;

  const diffX = startX - endX;
  const diffY = startY - endY;

  if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 60){
    if (diffX > 0 && currentSlide < totalSlide - 1) currentSlide++;
    if (diffX < 0 && currentSlide > 0) currentSlide--;
    updateSlide();
  }
}, { passive: true });

// INIT
createDots();
updateSlide();
</script>


</body>
</html>
